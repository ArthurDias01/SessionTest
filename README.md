This is a Test Project that used [Next.js](https://nextjs.org/) project bootstrapped with [`create-next-app`](https://github.com/vercel/next.js/tree/canary/packages/create-next-app) and shadcn/ui library [Shadcd/ui](https://ui.shadcn.com/).


## Challenge Description:

Sessions Analytics
You’re in charge of implementing a new analytics “sessions” view. You’re given a set of data that consists of individual web page visits, along with a visitorId which is generated by a tracking cookie that uniquely identifies each visitor. From this data we need to generate a list of sessions for each visitor.

The data set looks like this:

```json
{
    "events": [
         {
             "url": "/pages/a-big-river",
             "visitorId": "d1177368-2310-11e8-9e2a-9b860a0d9039",
             "timestamp": 1512754583000
         },
         {
             "url": "/pages/a-small-dog",
             "visitorId": "d1177368-2310-11e8-9e2a-9b860a0d9039",
             "timestamp": 1512754631000
         },
        {
            "url": "/pages/a-big-talk",
            "visitorId": "f877b96c-9969-4abc-bbe2-54b17d030f8b",
            "timestamp": 1512709065294
        },
        {
            "url": "/pages/a-sad-story",
            "visitorId": "f877b96c-9969-4abc-bbe2-54b17d030f8b",
            "timestamp": 1512711000000
        },
        {
            "url": "/pages/a-big-river",
            "visitorId": "d1177368-2310-11e8-9e2a-9b860a0d9039",
            "timestamp": 1512754436000
        },
        {
            "url": "/pages/a-sad-story",
            "visitorId": "f877b96c-9969-4abc-bbe2-54b17d030f8b",
            "timestamp": 1512709024000
        }
    ]
}
```

Given this input data, we want to create a set of sessions of the incoming data. A sessions is defined as a group of events from a single visitor with no more than 10 minutes between each consecutive event. A visitor can have multiple sessions. So given the example input data above, we would expect output which looks like:

```json
{
    "sessionsByUser": {
        "f877b96c-9969-4abc-bbe2-54b17d030f8b": [
            {
                "duration": 41294,
                "pages": [
                    "/pages/a-sad-story",
                    "/pages/a-big-talk"
                ],
                "startTime": 1512709024000
            },
            {
                "duration": 0,
                "pages": [
                    "/pages/a-sad-story"
                ],
                "startTime": 1512711000000
            }
        ],
        "d1177368-2310-11e8-9e2a-9b860a0d9039": [
            {
                "duration": 195000,
                "pages": [
                    "/pages/a-big-river",
                    "/pages/a-big-river",
                    "/pages/a-small-dog"
                ],
                "startTime": 1512754436000
            }
        ]
    }
}
```

Notes

- Timestamps are in milliseconds.
- Events may not be given in chronological order.
- The visitors in sessionsByUser can be in any order.
- For each visitor, sessions to be in chronological order.
- For each session, the URLs should be sorted in chronological order
- For a session with only one event the duration should be zero
- Each event in a session (except the first event) must have occurred within 10 minutes of the preceding event in the session. This means that there can be more than 10 minutes between the first and the last event in the session.


## Solution:

- [x] Createad a landing page showing example data input and output.
- [x] <https://vercelpage/test> page to test your own data.
- [x] Created an API (POST) end-point to test as an api sending the data through the body as a JSON content the end-point is: <https://vercelpage/api/test> .

## Solution Function Explained:

- 1. Create an empty object to store the sessions of each user
- 2. Sort events by timestamp in ascending order
- 3. Group events by visitorId
- 4. If the visitorId does not exist, create an empty array to store the sessions
- 5. If the visitorId exists, get the last session
- 6. If the last session exists and the timestamp is less than 10 minutes, add the page to the session
- 7. If the last session does not exist or the timestamp is greater than 10 minutes, create a new session
- 8. Sort sessions and pages chronologically for each visitor
- 9. Return the sessionsByUser object

```ts
import { InputData, OutputData, Session, SessionsByUser } from "@/interfaces/global";

export function transformData(input: InputData): OutputData {
  const { events } = input;

  //Cria um objeto vazio para armazenar as sessões de cada usuário

  const sessionsByUser: SessionsByUser = {};

  // Ordenar eventos por timestamp em ordem crescente
  events.sort((a, b) => a.timestamp - b.timestamp);

  // Agrupar eventos por visitorId

  for (const event of events) {
    const { visitorId, timestamp, url } = event;

    // Se o visitorId não existir, cria um array vazio para armazenar as sessões

    if (!sessionsByUser[visitorId]) {
      sessionsByUser[visitorId] = [];
    }

    const sessions = sessionsByUser[visitorId];

    // Se o visitorId existir, pega a última sessão

    const currentSession = sessions.length > 0 ? sessions[sessions.length - 1] : null;

    // Se a última sessão existir e o timestamp for menor que 10 minutos, adiciona a página à sessão

    if (
      currentSession &&
      timestamp - currentSession.startTime <= 10 * 60 * 1000
    ) {
      currentSession.pages.push(url);
      currentSession.duration = timestamp - currentSession.startTime;
    } else {

      // Se a última sessão não existir ou o timestamp for maior que 10 minutos, cria uma nova sessão

      const newSession: Session = {
        duration: 0,
        pages: [url],
        startTime: timestamp,
      };
      sessions.push(newSession);
    }
  }

  // Ordenar sessões e páginas cronologicamente para cada visitante

  for (const visitorId in sessionsByUser) {
    sessionsByUser[visitorId].forEach((session) => {
      session.pages.sort();
    });
    sessionsByUser[visitorId].sort((a, b) => a.startTime - b.startTime);
  }

  return { sessionsByUser };
}
```
